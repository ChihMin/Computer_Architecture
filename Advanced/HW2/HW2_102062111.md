# <center> Advanced Computer Architecture </center>

### <center> [HW2] 102062111 林致民 </center>

## PART II

*(以下的實驗都是採用gcc作為benchmark)*

### (a) Study the effect of the size of L2 Cache

這裡我選了一些L2 cache szie，分別是 [1 2 4 8 16 32 64 128 256]，這些size都是2的次方數

* **L2 Cache Miss Rate** ![img](./figure/l2_miss_rate.png) 其實可以發現到，L2 Cache miss rate 在 2MB ~ 4MB 有些微的減少，但是在8MB之後，都沒有減少cache miss rate 的跡象。

* **L2 Cache average miss latency** ![img](./figure/l2_miss_latency.png) 變化最劇烈的部分在 1MB 的L2 Cache Size --> 2MB 的L2 Cache Size，增加L2 cache 的確可以減少miss latency。但是從2MB增加到4MB，latency 反而會上升，之後就沒變化，

* **Sim seconds** ![img](./figure/l2_sim_seconds.png) 這個實驗有趣的地方在於sim seconds 除了從1 MB的 L2 cahce增加到2MB的 L2 cache 會見少以外，其他的sim seconds 都是一樣的數值，L2 cache 持續增大依舊不能減少sim_seconds。

### (b) Calculate the average memory access time ofr L1 Cache

從(a)跑出來的數據中，抓出L1 cacache(d\_cache & i_cache)的miss rate和total access，目的是要計算L1 cache的average miss rate，L1 cache average miss rate 的計算方式如下：
	
### <center> $L1\ cache\ average\ miss\ rate = \frac{d\_access \times d\_miss\_rate + i\_access \times i\_miss\_rate}{d\_access+i\_access}$ </center>

再來就是L1 cache 的 Average memory access time(以下簡稱**AMAT**)，**AMAT**的計算方式如下：

##### <center> $AMAT = hit + miss\ rate\ \times\ miss\ penalty$ </center>

當L1 cache miss的時候，這時候情況會分為兩種：(a) L2 cache hit  (b) L2 cache miss。所以L1 cache的***miss penalty***取決於L2 cache 的**AMAT**，所以修正L1 Cache AMAT的計算方式：

##### <center> $L2\_AMAT = L2\ hit + L2\ miss\ rate \times L2\ miss\ penalty$ </center>

##### <center> $L1\_AMAT = L1\ hit + L1\ miss\ rate \times L2\ AMAT$ </center>

**以下是所有跑出來的數據：**

|L2 cache(MB)|d_access|d\_miss_rate|i_access|i\_miss_rate|L1\_miss_rate| L1 AMAT|
|:----------:|:------:|:---------:|:------:|:---------:|:----------:|:----:|
|1 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1907933725607434 |
|2 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.189887912391144 |
|4 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|8 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|16 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|32 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|64 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|128 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|256 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|512 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |
|1024 | 2665101.0 | 0.005937 | 11248307.0 | 0.002112| 0.00284468 | 1.1898772448585144 |

在 L2 Cache 從 1MB 增加到 4MB，L1 Cache 的 AMAT 會變少，之後還是一樣維持不變，不過造成這個現象的原因是，L1 cache 的miss rate ***並沒有因為 L2 cache size 而改變***，反倒是因為L2 Cache miss rate 改變才會造成 L1 AMAT 的數據變化。 

### (c) Study the effects of the associativity of L2 cache. 

首先我選擇四種不同的cache size : 1MB, 2MB, 4MB, 8MB 和四種不同的L2 Set associative：1, 2, 4, 8。這個實驗室要觀察不同 cache size 和不同set assiciative 之間有什麼關係。***（以下的圖表折線分別表示不同的cache size：藍色1MB、紅色2MB、粉紅色4MB，黑色8MB)***

* **Miss rate** ![img](./figure/l2_miss_rate_set.png) 1 MB cache size 增加set的個數，會大幅降低miss rate，而8MB的miss rate，miss rate 基本上完全沒有變化。可以從圖表推論，當我的L2 cache size 越大的時候，set個數增加能夠降低miss rate的幅度越小。

* **Miss latency** ![img](./figure/l2_miss_latency_set.png) 1MB 和 2MB 的cache size有個共同現象是，從1個set 增加變成2個set，miss latency會下降，但是在之後增加set個數就不一定了。4MB的cache 從1 set增加到2 set，其miss latency反而會上升。16MB的倒是完全沒有變化。





